<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>歌单匹配</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/quasar@2.5.5/dist/quasar.prod.css"
      rel="stylesheet"
      type="text/css"
    />
    <style type="text/css">
      a {
        text-decoration: none;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <q-layout view="hHh lpR fFf">
        <q-header elevated class="bg-primary text-white">
          <q-toolbar>
            <q-btn dense flat round icon="menu" @click="toggleLeftDrawer" />

            <q-toolbar-title> 歌单匹配 </q-toolbar-title>
          </q-toolbar>
        </q-header>

        <q-drawer show-if-above v-model="leftDrawerOpen" side="left" bordered>
          <q-list padding>
            <q-item
              clickable
              v-ripple
              @click='open_external_link("https://music.163.com/#/user/home?id=319475460")'
            >
              <q-item-section avatar>
                <q-icon name="launch" />
              </q-item-section>
              <q-item-section> 我的网易云音乐主页 </q-item-section>
            </q-item>

            <q-item
              active
              clickable
              v-ripple
              @click='open_external_link("https://github.com/oldshensheep")'
            >
              <q-item-section avatar>
                <q-icon name="launch" />
              </q-item-section>
              <q-item-section> Github </q-item-section>
            </q-item>
            <div class="text-center q-mt-lg">我的歌单id：444265995</div>
          </q-list>
        </q-drawer>

        <q-page-container>
          <div class="q-pa-md q-mx-auto" style="max-width: 1000px">
            <q-form @submit="onSubmit" @reset="onReset">
              <q-input
                filled
                clearable
                v-model="your_input"
                label="你的歌单ID或App分享的链接"
                autogrow
                :rules="idRules"
              ></q-input>

              <div class="bg-grey-2 q-pa-sm rounded-borders flex items-center">
                你的平台:
                <q-option-group
                  v-model="your_platform"
                  :options="options"
                  inline
                ></q-option-group>
              </div>
              <q-input
                class="q-mt-lg"
                filled
                clearable
                v-model="her_input"
                label="ta的歌单ID或App分享的链接"
                autogrow
                :rules="idRules"
              ></q-input>
              <div class="bg-grey-2 q-pa-sm rounded-borders flex items-center">
                ta的平台:
                <q-option-group
                  v-model="her_platform"
                  :options="options"
                  inline
                ></q-option-group>
              </div>
              <div
                class="bg-grey-2 q-pa-sm rounded-borders flex items-center q-mt-lg"
              >
                <q-toggle v-model="accept" label="我接受"></q-toggle>
                <div style="color: blue" @click="alert">服务协议</div>
              </div>

              <div class="q-mt-lg">
                <q-btn label="Submit" type="submit" color="primary"></q-btn>
                <q-btn
                  label="Reset"
                  type="reset"
                  color="primary"
                  flat
                  class="q-ml-sm"
                ></q-btn>
              </div>
            </q-form>
            <div class="q-mt-lg">
              <div>
                你的歌单有<q-badge color="blue"> {{your_playlist_len}}</q-badge
                >首歌
              </div>
              <div>
                ta的歌单有
                <q-badge color="red"> {{her_playlist_len}}</q-badge>首歌
              </div>
              <div>
                你和ta有<q-badge color="green"> {{same.length}} </q-badge>
                首相同的歌曲
              </div>
              <div>
                相似度
                <q-badge color="purple">
                  {{(same.length*2/(your_playlist_len+her_playlist_len)*100).toFixed(2)}}%
                </q-badge>
                <div class="text-grey">
                  计算公式 相同歌曲数量*2/(你的歌曲数量+ta的曲数量)
                </div>
              </div>
            </div>

            <q-table
              class="q-mt-lg"
              row-key="id"
              :filter="filter"
              :rows="same"
              :columns="columns"
              :pagination="{rowsPerPage: 0}"
            >
              <template v-slot:body-cell-index="props">
                <q-td :props="props">
                  <div>{{props.rowIndex+1}}</div>
                </q-td>
              </template>
              <template v-slot:body-cell-name="props">
                <q-td :props="props">
                  <div>
                    <a
                      target="_blank"
                      :href="'https://music.163.com/#/song?id=' + props.row.id"
                    >
                      {{props.value}}
                    </a>
                  </div>
                </q-td>
              </template>
              <template v-slot:top-right>
                <q-input
                  borderless
                  dense
                  debounce="300"
                  v-model="filter"
                  placeholder="Search"
                >
                  <template v-slot:append>
                    <q-icon name="search" />
                  </template>
                </q-input>
              </template>
            </q-table>
          </div>
        </q-page-container>
      </q-layout>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quasar@2.5.5/dist/quasar.umd.prod.js"></script>
    <script src="./api.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
